# SUDP

适用于文件传输的可靠UDP。

#### 包格式

​      `原始数据 包头`；与大多数数据包格式不同，**SUDP**的首部在最后

###### 包头

`校验(4B) 数据偏置(38b) 填充(1b) 最后包(1b)`

- 校验使用CRC32（0x104C11DB7）；校验的数据是填充后的的原始数据。
- 数据偏置表示此数据包第一字节在文件中的位置，第一个数据包的的数据偏置应该为0。此参数限制了最大传输文件大小，`2^38-1=274,877,906,944-1=256GB-1B`。我们规定最大传输大小为`0011 1111 1111 1111 1111 1111 0000 0000 0000 0000` = 274,877,841,408 Byte ~= 255.99GB； 当偏置大于此值时不是数据包包。
- 填充使得整数据包大小为16字节的整数倍；填充方法为循环填充填充长度的值；如整个包长度为214，则填充数据为`6 6 6 6 6 6`。
- 最后包为1表示是此文件的最后一个数据包，并不表示此文件传输完成。非数据包的值应该是0。

###### 数据包

​    承载的是文件数据。

###### 开始包

​    文件传输开始，在信息包之后，偏置：`0011 1111 1111 1111 1111 1111 0000 0000 0000 0000`；

###### 信息包

​    承载文件的信息：文件大小和文件相对路径前5个字节是文件大小，其他则可以存储路径；偏置：`0011 1111 1111 1111 1111 1111 1000 0000 0000 0000`；

###### 重发包

   用于控制重发数据，由5字节的偏置和2字节的长度组成一组元数据，元数据可以叠加组成重发包的数据；偏置：`0011 1111 1111 1111 1111 1111 0100 0000 0000 0000`；

###### 结束包

   表示一个文件的传输结束。偏置：`0011 1111 1111 1111 1111 1111 0000 0000 0000 0001`

